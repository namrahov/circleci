name: Master CI
on:
  push:
    branches:
      - master


jobs:
  DEPLOY:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: ðŸªœ Set up JDK 16
        uses: actions/setup-java@v1
        with:
          java-version: 16

      - name: ðŸ”¦ Test
        run: |
          chmod +x ./gradlew
          ./gradlew test

      # Create `build/jacoco/jacocoMergeSubprojects.exec`
      - name: â›ˆ 1) Jacoco merge subprojects reports
        run: ./gradlew jacocoMergeSubprojects -x test

      # Create `build/reports/jacoco/jacocoAggregatedReport/jacocoAggregatedReport.xml`
      - name: â›ˆ 2) Jacoco Jacoco aggregated report
        run: ./gradlew jacocoAggregatedReport -x test

      - name: â›ˆ 3) Sonarqube report
        run: ./gradlew sonarqube -x test
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}